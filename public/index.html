<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Estado de Usuarios</title>
    <style>
      :root {
        --primary: #9f6118;
        --primary-light: #c27b30;
        --bg-color: #f1ede6;
        --text-color: #2e2e2e;
        --text-soft: #7a6a56;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          sans-serif;
        background: linear-gradient(135deg, var(--bg-color) 0%, #e8e1d8 100%);
        color: var(--text-color);
        min-height: 100vh;
        padding: 20px;
      }

      .header {
        text-align: center;
        margin-bottom: 40px;
        background: white;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(159, 97, 24, 0.1);
        backdrop-filter: blur(10px);
      }

      .logo {
        width: 80px;
        height: 80px;
        margin-bottom: 20px;
        border-radius: 50%;
        object-fit: contain;
        background: white;
        padding: 10px;
        box-shadow: 0 4px 20px rgba(159, 97, 24, 0.2);
      }

      .header h1 {
        color: var(--primary);
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(159, 97, 24, 0.1);
      }

      .subtitle {
        color: var(--text-soft);
        font-size: 1.1rem;
        font-weight: 400;
      }

      .stats-bar {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin: 30px 0;
        flex-wrap: wrap;
      }

      .stat-item {
        background: white;
        padding: 15px 25px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(159, 97, 24, 0.1);
        text-align: center;
        min-width: 120px;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary);
        display: block;
      }

      .stat-label {
        color: var(--text-soft);
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      #users-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
        max-width: 1400px;
        margin: 0 auto;
      }

      .user-card {
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 32px rgba(159, 97, 24, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid transparent;
        position: relative;
        overflow: hidden;
      }

      .user-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--primary),
          var(--primary-light)
        );
        border-radius: 20px 20px 0 0;
      }

      .user-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 40px rgba(159, 97, 24, 0.2);
      }

      .user-header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
      }

      .user-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-light)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.5rem;
        margin-right: 15px;
        box-shadow: 0 4px 15px rgba(159, 97, 24, 0.3);
      }

      .user-info h3 {
        color: var(--text-color);
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .user-id {
        color: var(--text-soft);
        font-size: 0.9rem;
        font-weight: 500;
      }

      .status-badge {
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin: 15px 0;
      }

      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      .PAUSED .status-badge {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }

      .PAUSED .status-indicator {
        background: #ffc107;
      }

      .OPENED .status-badge {
        background: #d1edff;
        color: #0c63e4;
        border: 1px solid #74b9ff;
      }

      .OPENED .status-indicator {
        background: #28a745;
      }

      .CLOSED .status-badge {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .CLOSED .status-indicator {
        background: #dc3545;
      }

      .last-update {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-soft);
        font-size: 0.9rem;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e9ecef;
      }

      .clock-icon {
        width: 16px;
        height: 16px;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: var(--text-soft);
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--bg-color);
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      @media (max-width: 768px) {
        #users-container {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 2rem;
        }

        .stats-bar {
          gap: 15px;
        }

        .stat-item {
          min-width: 100px;
          padding: 10px 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <img
        src="https://space-img.sfo3.digitaloceanspaces.com/Agencias/gehlogo.png"
        alt="Logo"
        class="logo"
      />
      <h1>Estado de Usuarios</h1>
      <p class="subtitle">Monitoreo en tiempo real del estado de usuarios</p>

      <div class="stats-bar">
        <div class="stat-item">
          <span class="stat-number" id="total-users">0</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="active-users">0</span>
          <span class="stat-label">Activos</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="paused-users">0</span>
          <span class="stat-label">En Pausa</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="closed-users">0</span>
          <span class="stat-label">Cerrados</span>
        </div>
      </div>
    </div>

    <div id="users-container">
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando datos de usuarios...</p>
      </div>
    </div>

    <script>
      function getInitials(name) {
        return name
          .split(" ")
          .map((n) => n[0])
          .join("")
          .toUpperCase()
          .substring(0, 2);
      }

      function getStatusText(status) {
        const statusMap = {
          PAUSED: "En Pausa",
          OPENED: "Activo",
          CLOSED: "Cerrado",
        };
        return statusMap[status] || status;
      }

      function updateStats(users) {
        const total = users.length;
        const opened = users.filter((u) => u.status === "OPENED").length;
        const paused = users.filter((u) => u.status === "PAUSED").length;
        const closed = users.filter((u) => u.status === "CLOSED").length;

        document.getElementById("total-users").textContent = total;
        document.getElementById("active-users").textContent = opened;
        document.getElementById("paused-users").textContent = paused;
        document.getElementById("closed-users").textContent = closed;
      }

      function actualizarEstados() {
        fetch("http://143.198.118.131:8085/hook/notificacion/users-status")
          .then((response) => response.json())
          .then((users) => {
            const container = document.getElementById("users-container");
            container.innerHTML = "";

            updateStats(users);

            users.forEach((user, index) => {
              const card = document.createElement("div");
              card.className = `user-card ${user.status}`;

              const initials = getInitials(user.nombre);
              const statusText = getStatusText(user.status);
              const updateTime = new Date().toLocaleTimeString("es-ES");

              card.innerHTML = `
                <div class="user-header">
                  <div class="user-avatar">${initials}</div>
                  <div class="user-info">
                    <h3>${user.nombre}</h3>
                    <div class="user-id">ID: ${user.id || index + 1}</div>
                  </div>
                </div>
                
                <div class="status-badge">
                  <div class="status-indicator"></div>
                  ${statusText}
                </div>
                
                <div class="last-update">
                  <svg class="clock-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                  </svg>
                  Última actualización: ${updateTime}
                </div>
              `;

              container.appendChild(card);
            });
          })
          .catch((error) => {
            console.error("Error:", error);
            const container = document.getElementById("users-container");
            container.innerHTML = `
              <div class="loading">
                <p>Error al cargar los datos. Reintentando en 30 segundos...</p>
              </div>
            `;
          });
      }

      // Actualizar cada 30 segundos
      setInterval(actualizarEstados, 30000);
      actualizarEstados(); // Primera carga
    </script>
  </body>
</html>
